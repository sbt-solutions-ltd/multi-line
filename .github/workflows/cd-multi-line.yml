# Name of the Workflow
name: CD TEST

on:
  push:
    branches:
      - 'testing'
  #Start workflow manually only from main/master, stage and production branches only.
  workflow_dispatch:
    branches:
      - 'testing'
    inputs:
      environment:
        description: 'The environment Terraform should build: development, testing or production'
        type: choice
        options:
        - development
        - testing
        - production
        required: false
        default: 'development'


jobs:
  ssh_key_convert:
    runs-on: ubuntu-latest
    name: A job to pass environment variables based on branches and Terraform environment
    steps:
      - uses: actions/checkout@v2

       # Calling the action
      - id: envs
        uses: zerodt-io/multi-line@v1.3
        with:
          SSH-KEY-DEV: key-dev
          SSH-KEY-TEST: key-test
          SSH-KEY-STAGE: key-stage
          SSH-KEY-PROD: key-prod
          SG-ID-DEV: sg-dev
          SG-ID-TEST: sg-test
          SG-ID-STAGE: sg-stage
          SG-ID-PROD: sg-prod
          BASTION-IP-DEV: bastion-ip-dev
          BASTION-IP-TEST: bastion-ip-test
          BASTION-IP-STAGE: bastion-ip-stage
          BASTION-IP-PROD: bastion-ip-prod
          REGION-DEV: us-east-2
          REGION-TEST: us-east-2
          REGION-STAGE: us-east-1
          REGION-PROD: eu-north-1

       # The outputs the action produces
      - run: |
          echo "New key is ${{ steps.envs.outputs.SSH-KEY-SINGLE }}"
          echo "New branch is ${{ steps.envs.outputs.ENV_BRANCH }}"
          echo "New region is ${{ steps.envs.outputs.ENV_REGION }}"
          echo "New IP is ${{ steps.envs.outputs.BASTION_IP }}"
          echo "New SG ID is ${{ steps.envs.outputs.SG_ID }}"
        shell: bash